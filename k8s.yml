# ------------------------------------------------------------------------------
#
#    DO NOT MODIFY THIS FILE !!!
#
#    Configuration properties should be specified in .env file
#
#    Application based on OpenVidu should be specified in
#    docker-compose.override.yml file
#
#    This docker-compose file coordinates all services of OpenVidu CE Platform.
#
#    This file will be overridden when update OpenVidu Platform
#
#    Openvidu Version: 2.14.0
#
#    Installation Mode: On Premises
#
# ------------------------------------------------------------------------------

version: '3.1'

services:

    openvidu-server:
        image: openvidu/openvidu-server:2.15.0-beta1
        restart: on-failure
        network_mode: host
        entrypoint: ['/bin/bash', '-c', 'export COTURN_IP=`/usr/local/bin/discover_my_public_ip.sh`; /usr/local/bin/entrypoint.sh']
        env_file:
            - .env
        environment:
            - SERVER_SSL_ENABLED=false
            - SERVER_PORT=5443
            - KMS_URIS=["ws://localhost:8888/kurento"]
            - COTURN_REDIS_IP=127.0.0.1
            - COTURN_REDIS_PASSWORD=TROOD

    kms:
        image: kurento/kurento-media-server:6.14.0
        restart: always
        network_mode: host
        ulimits:
          core: -1
        environment:
            - KMS_MIN_PORT=40000
            - KMS_MAX_PORT=57000

    redis:
        image: openvidu/openvidu-redis:1.0.0
        restart: always
        network_mode: host
        environment:
            - REDIS_PASSWORD=TROOD

    coturn:
        image: openvidu/openvidu-coturn:1.0.0
        restart: on-failure
        network_mode: host
        environment:
            - REDIS_IP=127.0.0.1
            - TURN_LISTEN_PORT=3478
            - DB_NAME=0
            - DB_PASSWORD=TROOD
            - MIN_PORT=57001
            - MAX_PORT=65535